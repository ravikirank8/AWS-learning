| Component                  | Purpose                                                      |
| -------------------------- | ------------------------------------------------------------ |
| **CIDR Block**             | Defines IP range of the VPC (e.g., `10.0.0.0/16`)            |
| **Subnets**                | Divide VPC into logical zones (public or private)            |
| **Route Tables**           | Decide how traffic flows (local, internet, NAT)              |
| **Internet Gateway (IGW)** | Enables internet access to public subnets                    |
| **NAT Gateway**            | Enables private subnets to access internet **outbound only** |
| **Security Groups**        | Stateful firewalls per resource                              |
| **NACLs**                  | Stateless firewalls per subnet                               |
| **DHCP Options Set**       | Controls DNS name resolution settings                        |

ğŸ”¹ VPC and Regions
Every VPC exists inside a single AWS region.

You can create multiple VPCs per region (limit: 5 by default, can increase).

VPC is regional, but its subnets are AZ-specific (Availability Zones).

â— VPC does NOT span regions, only AZs within a region.

ğŸ”¸ Default VPC
When you create an AWS account, AWS automatically gives you a default VPC in each region.

| Feature          | Default VPC                         |
| ---------------- | ----------------------------------- |
| Exists?          | Yes, in every region                |
| Subnets          | 1 per AZ, already created           |
| Internet access? | Yes, via attached Internet Gateway  |
| Public IPs       | Automatically assigned to instances |
| DNS Support      | Enabled by default                  |


ğŸ”¹ Public IP vs Private IP
ğŸ”¸ Private IP
Always assigned to every EC2 instance (even in private subnets).
Used for internal communication.

Stays with the instance across reboots (unless replaced manually).
ğŸ”¸ Public IP
Assigned only if in a public subnet + explicitly enabled.

Used for internet access.
Dynamic: Changes if you stop/start the instance (unless using Elastic IP).

ğŸ”¹ Does Public IP Get Assigned by Default?
ğŸ”¹ Does Public IP Get Assigned by Default?

âœ… How a Solution Architect Should Think


Do you need a new network?
 â””â”€â”€ Yes â†’ Create a VPC
        â”œâ”€â”€ Need internet-facing apps?
        â”‚     â”œâ”€â”€ Yes â†’ Create public subnet + IGW
        â”‚     â””â”€â”€ No  â†’ Private subnet + NAT Gateway (optional)
        â”œâ”€â”€ Need fixed IP?
        â”‚     â””â”€â”€ Use Elastic IP
        â”œâ”€â”€ Need to connect to on-prem?
        â”‚     â””â”€â”€ Use Site-to-Site VPN or Direct Connect
        â””â”€â”€ Want to allow DNS resolution?
              â”œâ”€â”€ Yes â†’ Enable DNS Support + DNS Hostnames


| Question                                      | Architectural Reason                                                      |
| --------------------------------------------- | ------------------------------------------------------------------------- |
| Do I need internet access for this workload?  | If yes, place in public subnet + IGW. If no, keep private.                |
| Should the instance be accessible externally? | Use public IP only if absolutely needed.                                  |
| Should I keep the IP consistent?              | Assign Elastic IP.                                                        |
| Is this VPC secure?                           | Use NACLs, SGs, and avoid overly permissive rules.                        |
| Should I use default or custom VPC?           | Use **custom VPC** in production â€” more control.                          |
| Should I isolate workloads?                   | Use **multiple subnets** and **multiple AZs**.                            |
| Should I peer/connect with other networks?    | Consider **VPC peering**, **Transit Gateway**, or **VPN/Direct Connect**. |


ğŸ”¹ What is DNS in a VPC?
DNS (Domain Name System) in a VPC allows your EC2 instances and other services to resolve:
Private DNS names to private IPs (internal resolution)
Public DNS names to public IPs (external resolution)

ğŸ“Œ Summary Cheat Sheet (Exam-Ready)
âœ… enableDnsSupport = Allows EC2 to use VPC DNS resolver.
âœ… enableDnsHostnames = Gives EC2 DNS hostnames for public/private IPs.
â— Both must be true to assign public DNS names to EC2 instances with public IPs.
ğŸ” Always design VPCs with DNS support in mind for internal and external name resolution.
ğŸ”„ DNS changes can affect how instances communicate, especially with Route 53 private hosted zones or VPC peering.

Route 53 private hosted zone names
In other words:
DNS in a VPC = name-to-IP translation inside your private AWS network.

ğŸ”¸ Why Is DNS Important in AWS?
As a Solution Architect, you need to use DNS to:
Avoid hardcoding IP addresses
Enable service discovery
Work with microservices, Lambda, ECS, EKS, etc.
Use Route 53 for internal domain resolution
Ensure VPC-peered resources can resolve names

ğŸ”¹ Two Main DNS Options in a VPC
These options are VPC-level settings that control DNS behavior:

| Option                 | Default                                                | Meaning                                                                             |
| ---------------------- | ------------------------------------------------------ | ----------------------------------------------------------------------------------- |
| **enableDnsSupport**   | `true`                                                 | Allows instances in the VPC to use **Amazon-provided DNS server**                   |
| **enableDnsHostnames** | `false` (for custom VPC) <br> `true` (for default VPC) | Assigns **DNS hostnames** (like `ec2-1-2-3-4.compute-1.amazonaws.com`) to instances |






Automatic DNS Entries: Private IP addresses are automatically mapped to DNS entries.
AWS DNS Server Access: The DNS servers can be accessed at the second IP in the VPC CIDR block or via 169.254.169.253.
Enable DNS Hostnames: Necessary to assign public DNS hostnames to instances with public IP addresses.
Enable DNS Support: Must be active for the VPC to resolve DNS queries using AWS-provided servers.


Step	                            Action	                                                      Expected Outcome
Dynamic IP Demonstration	        Stop and restart the instance	                      Public IP changes from 52.90.159.117 to a new value
Allocating an Elastic IP	        Allocate a new Elastic IP in EC2 dashboard        	A static IP (e.g., 35.173.92.86) is assigned to your account
Associating the Elastic IP	      Associate the Elastic IP with your instance	       The instance now consistently uses the Elastic IP
Verifying Connectivity	          Ping the Elastic IP	                               Successful replies confirm connectivity
Ensuring Elastic IP Persistence 	Reboot the instance	                              Elastic IP remains unchanged
Releasing the Elastic IP	       Disassociate and release the Elastic IP	           Elastic IP is removed from your account

ğŸ”¸ enableDnsSupport = true âœ…
"Can I resolve domain names inside this VPC?"
If true â†’ Instances can resolve DNS using AWSâ€™s built-in DNS.

If false â†’ No DNS resolution works inside the VPC.

ğŸ§  Architect Insight:
This is the core DNS engine switch.
Keep it enabled always, unless youâ€™re using custom DNS resolvers (rare).

ğŸ”¸ enableDnsHostnames = true âœ…
"Should AWS assign public DNS names to EC2 instances?"
If true:

Public IPs get public DNS names.
Private IPs get private DNS names.

If false:
Even if EC2 has a public IP, no public DNS name is given.

ğŸ§  Architect Insight:
Required if you want to SSH using ec2-xx-xx-xx-xx.compute.amazonaws.com
Needed for internal name resolution
Also required when using Route 53 private hosted zones

ğŸ§ª Example Scenarios
Example 1: Default VPC
âœ… enableDnsSupport = true

âœ… enableDnsHostnames = true

âœ… Outcome: EC2 gets both private and public DNS names.

You can SSH into the instance using the DNS name.

Example 2: Custom VPC for Internal App
âœ… enableDnsSupport = true

âŒ enableDnsHostnames = false (default)

Outcome:

EC2 gets a private IP, but no DNS hostname

Canâ€™t resolve internal service names easily

â¡ï¸ Fix: Enable enableDnsHostnames via console, CLI, or Terraform


ğŸ” What Are AWS Firewalls?
In AWS, firewalls are used to control which traffic can go in and out of your cloud resources like EC2 instances or entire networks.
There are two main tools you use for this in AWS:

Security Groups
Network ACLs (NACLs)

Both help protect your cloud resources, but they work differently and are used for different reasons.

ğŸ§± 1. Security Groups â€“ Think of them as Bodyguards for EC2
ğŸ‘‰ What is it?
A security group is like a gatekeeper for your EC2 instances (or databases, load balancers).
It allows certain types of traffic in and out, based on rules you define.

ğŸ‘‰ How it works?
Only allows traffic you approve (no â€œdenyâ€ rules).
Itâ€™s stateful â€“ means if someone is allowed in, AWS will automatically allow them back out.
Example: If you allow traffic on port 80 (HTTP), return traffic is automatically allowed.

ğŸ‘‰ Where and when to use?
Use it for specific resources like:
EC2 servers
RDS databases
Load balancers (ALB/NLB)
When you want to control access per resource.

âœ… Best Practice:
Only open necessary ports (e.g., 22 for SSH, 80/443 for web).
Donâ€™t allow 0.0.0.0/0 (open to all) unless really needed.
Group rules based on purpose (like WebSG, DBSG).

ğŸŒ 2. NACLs (Network Access Control Lists) â€“ Think of them as Fence for Your Subnet
ğŸ‘‰ What is it?
NACLs are like security fences for a group of machines (called a subnet).
They control who can enter or leave a subnet.
ğŸ‘‰ How it works?
NACLs have both allow and deny rules.
It is stateless â€“ means if you allow incoming traffic, you also have to allow outgoing traffic separately.
Example: If you allow traffic IN on port 80, you also need to allow OUT traffic on port 80 (or the response port), otherwise it will be blocked.

ğŸ‘‰ Where and when to use?
Use it at the subnet level when:
You want to block certain IPs (bad actors).
You want extra security on top of security groups.

âœ… Best Practice:
Use NACLs for broad rules.
Deny access to known bad IPs.
Make sure both inbound and outbound rules are set correctly.


ğŸ” Stateful vs Stateless (Key Difference)

| Feature         | Security Group             | NACL                           |
| --------------- | -------------------------- | ------------------------------ |
| Works on        | Instance (like EC2)        | Subnet (group of EC2s)         |
| Type            | Stateful (automatic reply) | Stateless (no automatic reply) |
| Rules           | Allow only                 | Allow and Deny                 |
| Direction setup | Inbound & Outbound         | Inbound & Outbound             |



ğŸ§  When to Use What? (Decision Flow)
Q: Do I want to control traffic to a specific EC2 or RDS?
â†’ Use Security Groups

Q: Do I want to block an IP at the subnet level?
â†’ Use NACLs

Q: Do I want automatic return traffic (easier setup)?
â†’ Use Security Groups

Q: Do I want to apply rules to all machines in a subnet?
â†’ Use NACLs

Q: Do I need to deny a specific IP or port?
â†’ Use NACLs


ğŸ’¡ Example Scenario
Letâ€™s say you have a web application and a database:

For the web server:

Security Group: Allow 80/443 from the internet.

NACL: Allow 80/443 from the internet, deny known bad IPs.

For the database server:

Security Group: Allow 3306 (MySQL) only from the web server.

NACL: Allow MySQL port from web subnet, deny everything else.



 Summary (In Simple Points)
Security Groups = For individual servers (like EC2). They are stateful and easier to manage.
NACLs = For entire subnets. They are stateless and give more control (like blocking IPs).

Use both together for better security (defense-in-depth).

Always allow only whatâ€™s necessary.
Monitor traffic using VPC Flow Logs
